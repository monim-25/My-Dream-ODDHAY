<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º - ODDHAY</title>
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'Hind Siliguri', 'sans-serif'],
                    },
                    colors: {
                        primary: '#0F172A', // Deep Slate
                        accent: '#2563EB',  // Royal Blue
                        secondary: '#64748B',
                        dark: '#0B1120',
                        light: '#F8FAFC'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Outfit', 'Hind Siliguri', sans-serif;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .dark .glass-effect {
            background: rgba(11, 17, 32, 0.9);
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body
    class="bg-[#F1F5F9] text-slate-800 dark:bg-[#020617] dark:text-slate-100 min-h-screen transition-colors duration-300">

    <!-- Top Navigation -->
    <header class="fixed top-0 left-0 right-0 z-50 glass-effect border-b border-slate-200 dark:border-slate-800 h-16">
        <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
            <!-- Logo area -->
            <div class="flex items-center gap-3">
                <button onclick="toggleSidebar()"
                    class="lg:hidden p-2 -ml-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <a href="/" class="flex items-center gap-2">
                    <img src="/images/logo.png"
                        onerror="this.src='https://ui-avatars.com/api/?name=Oddhay&background=0F172A&color=fff'"
                        class="h-8 w-8 rounded-lg" alt="Logo">
                    <span class="font-bold text-xl tracking-tight">ODDHAY</span>
                </a>
            </div>

            <!-- Right Actions -->
            <div class="flex items-center gap-4">
                <!-- Notifications -->
                <button class="relative p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                    <span
                        class="material-symbols-outlined text-slate-600 dark:text-slate-300 text-xl">notifications</span>
                    <% if(notifications && notifications.filter(n=> !n.isRead).length > 0) { %>
                        <span
                            class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border border-white dark:border-[#0F172A]"></span>
                        <% } %>
                </button>

                <!-- Profile Icon (Direct Link) -->
                <a href="/profile" class="block hover:opacity-80 transition-opacity">
                    <img src="<%= user.profileImage || `https://ui-avatars.com/api/?name=${user.name}&background=random` %>"
                        alt="Profile"
                        class="size-9 rounded-full border-2 border-white dark:border-slate-700 shadow-sm object-cover">
                </a>
            </div>
        </div>
    </header>

    <!-- Sidebar (Desktop) -->
    <aside id="sidebar"
        class="fixed top-16 left-0 bottom-0 w-64 bg-white dark:bg-[#0B1120] border-r border-slate-200 dark:border-slate-800 z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col hidden lg:flex">
        <div class="flex-1 overflow-y-auto p-4 space-y-1">
            <div class="px-3 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">‡¶Æ‡ßá‡¶á‡¶® ‡¶Æ‡ßá‡¶®‡ßÅ</div>

            <a href="/dashboard"
                class="flex items-center gap-3 px-3 py-2.5 bg-slate-900 text-white dark:bg-slate-800 rounded-xl font-medium shadow-sm">
                <span class="material-symbols-outlined">dashboard</span> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
            </a>
            <a href="/courses"
                class="flex items-center gap-3 px-3 py-2.5 text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-colors">
                <span class="material-symbols-outlined">school</span> ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶∞‡ßç‡¶∏
            </a>
            <a href="/analytics"
                class="flex items-center gap-3 px-3 py-2.5 text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-colors">
                <span class="material-symbols-outlined">analytics</span> ‡¶è‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶∏
            </a>
            <a href="/leaderboard"
                class="flex items-center gap-3 px-3 py-2.5 text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-colors">
                <span class="material-symbols-outlined">emoji_events</span> ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°
            </a>

            <div class="h-px bg-slate-100 dark:bg-slate-800 my-4"></div>

            <div class="px-3 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</div>
            <a href="/settings"
                class="flex items-center gap-3 px-3 py-2.5 text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-colors">
                <span class="material-symbols-outlined">settings</span> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
            </a>
        </div>

        <!-- Reference Bottom Actions -->
        <div class="p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50">
            <a href="/contact"
                class="flex items-center gap-3 px-3 py-2.5 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl font-medium transition-colors mb-1">
                <span class="material-symbols-outlined">headset_mic</span> ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó
            </a>
            <a href="/logout"
                class="flex items-center gap-3 px-3 py-2.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/10 rounded-xl font-medium transition-colors">
                <span class="material-symbols-outlined">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
            </a>
        </div>
    </aside>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" onclick="toggleSidebar()"
        class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden backdrop-blur-sm transition-opacity"></div>

    <!-- Main Content -->
    <main class="lg:ml-64 pt-20 pb-24 lg:pb-8 min-h-screen px-4 md:px-8">
        <div class="max-w-6xl mx-auto space-y-8">

            <!-- Welcome Banner -->
            <div
                class="bg-gradient-to-br from-slate-800 via-slate-900 to-black dark:from-slate-900 dark:to-black rounded-3xl p-6 md:p-8 text-white shadow-2xl relative overflow-hidden ring-1 ring-white/10">
                <!-- Abstract Shapes -->
                <div
                    class="absolute top-0 right-0 w-96 h-96 bg-accent/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2">
                </div>

                <div class="relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                    <div>
                        <p class="text-slate-300 text-sm font-medium mb-1">‡¶∂‡ßÅ‡¶≠‡ßç‡¶∞ ‡¶∏‡¶ï‡¶æ‡¶≤ üëã</p>
                        <h1 class="text-3xl md:text-4xl font-black tracking-tight mb-2">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, <%= user.name %>!</h1>
                        <p class="text-slate-400 text-sm max-w-lg">
                            ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßú‡¶æ‡¶∂‡ßã‡¶®‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì ‡¶è‡¶¨‡¶Ç ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∂‡¶ø‡¶ñ‡ßã‡•§ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ü‡¶ø ‡¶π‡ßã‡¶ï ‡¶∏‡¶´‡¶≤‡¶§‡¶æ‡¶∞! üöÄ
                        </p>
                    </div>

                    <!-- Upcoming Update Card -->
                    <div
                        class="bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl p-4 w-full md:w-auto min-w-[250px]">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="relative flex h-3 w-3">
                                <span
                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                            </span>
                            <span class="text-xs font-bold uppercase tracking-wider text-red-300">LIVE ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</span>
                        </div>
                        <% if(routineTasks && routineTasks.length> 0) { %>
                            <p class="font-bold text-sm">
                                <%= routineTasks[0].title %>
                            </p>
                            <p class="text-xs text-slate-400 mt-1">
                                <%= routineTasks[0].time || '‡¶Ü‡¶∏‡¶®‡ßç‡¶®' %>
                            </p>
                            <% } else { %>
                                <p class="font-bold text-sm">‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶®‡ßá‡¶á</p>
                                <p class="text-xs text-slate-400 mt-1">‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                                <% } %>
                    </div>
                </div>
            </div>

            <!-- Stats Overview -->
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <!-- Enrolled -->
                <div
                    class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm flex items-center gap-4">
                    <div
                        class="size-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-blue-600 flex items-center justify-center text-xl">
                        <span class="material-symbols-outlined">school</span>
                    </div>
                    <div>
                        <p class="text-2xl font-black dark:text-white">
                            <%= user.enrolledCourses ? user.enrolledCourses.length : 0 %>
                        </p>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wide">‡¶è‡¶®‡¶∞‡ßã‡¶≤‡ßç‡¶°</p>
                    </div>
                </div>

                <!-- Quiz -->
                <div
                    class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm flex items-center gap-4">
                    <div
                        class="size-12 rounded-xl bg-amber-50 dark:bg-amber-900/20 text-amber-600 flex items-center justify-center text-xl">
                        <span class="material-symbols-outlined">quiz</span>
                    </div>
                    <div>
                        <p class="text-2xl font-black dark:text-white">
                            <%= user.quizResults ? user.quizResults.length : 0 %>
                        </p>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wide">‡¶ï‡ßÅ‡¶á‡¶ú</p>
                    </div>
                </div>

                <!-- Points -->
                <div
                    class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm flex items-center gap-4 col-span-2 md:col-span-1">
                    <div
                        class="size-12 rounded-xl bg-purple-50 dark:bg-purple-900/20 text-purple-600 flex items-center justify-center text-xl">
                        <span class="material-symbols-outlined">stars</span>
                    </div>
                    <div>
                        <p class="text-2xl font-black dark:text-white">
                            <%= (user.quizResults || []).reduce((acc, curr)=> acc + (curr.score || 0), 0) %>
                        </p>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wide">‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü</p>
                    </div>
                </div>
            </div>

            <!-- Quick Services (Icons Grid) -->
            <div
                class="bg-white dark:bg-slate-900 rounded-3xl p-6 border border-slate-100 dark:border-slate-800 shadow-sm">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">‡¶ï‡ßÅ‡¶á‡¶ï ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</h3>
                <div class="grid grid-cols-4 md:grid-cols-7 gap-4 text-center">

                    <a href="/courses" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-blue-50 dark:group-hover:bg-blue-900/20 text-slate-600 dark:text-slate-300 group-hover:text-blue-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">class</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏</span>
                    </a>

                    <a href="/exams" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-red-50 dark:group-hover:bg-red-900/20 text-slate-600 dark:text-slate-300 group-hover:text-red-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">edit_document</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">‡¶è‡¶ï‡ßç‡¶∏‡¶æ‡¶Æ</span>
                    </a>

                    <a href="/notes" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-yellow-50 dark:group-hover:bg-yellow-900/20 text-slate-600 dark:text-slate-300 group-hover:text-yellow-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">description</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">‡¶®‡ßã‡¶ü‡¶∏</span>
                    </a>

                    <a href="/routine" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-green-50 dark:group-hover:bg-green-900/20 text-slate-600 dark:text-slate-300 group-hover:text-green-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">calendar_month</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®</span>
                    </a>

                    <a href="/ai-chat" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-purple-50 dark:group-hover:bg-purple-900/20 text-slate-600 dark:text-slate-300 group-hover:text-purple-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">smart_toy</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">AI
                            ‡¶ü‡¶ø‡¶â‡¶ü‡¶∞</span>
                    </a>

                    <a href="/qa" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-indigo-50 dark:group-hover:bg-indigo-900/20 text-slate-600 dark:text-slate-300 group-hover:text-indigo-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">chat</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">Q&A</span>
                    </a>

                    <a href="/question-bank" class="group flex flex-col items-center gap-2">
                        <div
                            class="size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 group-hover:bg-teal-50 dark:group-hover:bg-teal-900/20 text-slate-600 dark:text-slate-300 group-hover:text-teal-600 transition-all flex items-center justify-center shadow-sm border border-slate-100 dark:border-slate-700">
                            <span class="material-symbols-outlined text-2xl">library_books</span>
                        </div>
                        <span
                            class="text-xs font-bold text-slate-500 group-hover:text-slate-800 dark:group-hover:text-white">Q
                            ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï</span>
                    </a>

                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Column 1: Continue Learning (2/3 width) -->
                <div class="lg:col-span-2 space-y-6">

                    <!-- Continue Learning Card -->
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-primary/10 transition-colors">
                        </div>

                        <h3
                            class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary text-xl">play_circle</span> ‡¶∂‡ßá‡¶ñ‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá
                            ‡¶Ø‡¶æ‡¶®
                        </h3>

                        <% if(user.lastWatchedLesson && user.lastWatchedLesson.course) { %>
                            <div class="flex flex-col sm:flex-row gap-5 items-start sm:items-center">
                                <div
                                    class="w-full sm:w-48 aspect-video rounded-xl bg-slate-100 dark:bg-slate-800 overflow-hidden shrink-0 shadow-md relative">
                                    <img src="<%= user.lastWatchedLesson.course.thumbnail || '/images/course-default.jpg' %>"
                                        class="w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-black/20 flex items-center justify-center">
                                        <span
                                            class="material-symbols-outlined text-white text-4xl opacity-80">play_arrow</span>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <span
                                        class="inline-block px-2 py-1 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 text-[10px] font-black uppercase tracking-wider rounded-md mb-2">LAST
                                        PLAYED</span>
                                    <h4 class="text-lg font-bold text-slate-800 dark:text-white leading-tight mb-2">
                                        <%= user.lastWatchedLesson.lessonTitle %>
                                    </h4>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">
                                        <%= user.lastWatchedLesson.course.title %>
                                    </p>
                                    <div
                                        class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden mb-4">
                                        <div class="bg-primary h-full rounded-full" style="width: 45%"></div>
                                    </div>
                                    <a href="/course-details/<%= user.lastWatchedLesson.course._id %>"
                                        class="inline-flex items-center gap-2 text-sm font-bold text-primary hover:underline">
                                        ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶® <span class="material-symbols-outlined text-sm">arrow_forward</span>
                                    </a>
                                </div>
                            </div>
                            <% } else { %>
                                <div
                                    class="py-10 text-center border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-2xl">
                                    <span
                                        class="material-symbols-outlined text-4xl text-slate-300 mb-2">video_library</span>
                                    <p class="text-sm text-slate-500">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</p>
                                </div>
                                <% } %>
                    </div>

                    <!-- Available Courses (Unenrolled) -->
                    <div>
                        <div class="flex items-center justify-between mb-4 px-1">
                            <h3 class="text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2">
                                <span class="size-2 rounded-full bg-accent"></span> ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶∏‡¶Æ‡ßÇ‡¶π (Class <%=
                                    user.classLevel || 'General' %>)
                            </h3>
                        </div>

                        <div class="space-y-3">
                            <% if(recommendations && recommendations.length> 0) { %>
                                <% recommendations.slice(0, 3).forEach(course=> { %>
                                    <div
                                        class="group bg-white dark:bg-slate-900 p-3 rounded-2xl border border-slate-100 dark:border-slate-800 hover:border-slate-200 dark:hover:border-slate-700 transition-all flex items-center gap-4">
                                        <div
                                            class="size-20 rounded-xl bg-slate-100 dark:bg-slate-800 overflow-hidden shrink-0">
                                            <img src="<%= course.thumbnail || '/images/course-default.jpg' %>"
                                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <h4 class="font-bold text-slate-800 dark:text-white truncate">
                                                <%= course.title %>
                                            </h4>
                                            <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">
                                                <%= course.subject %> ‚Ä¢ <%= course.instructor || 'ODDHAY' %>
                                            </p>
                                            <div class="flex items-center gap-1 text-[10px] text-slate-400">
                                                <span class="material-symbols-outlined text-xs">star</span> 4.8 (120
                                                reviews)
                                            </div>
                                        </div>
                                        <a href="/course-details/<%= course._id %>"
                                            class="px-4 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-xs font-bold rounded-lg hover:opacity-90 transition-opacity">
                                            ‡¶è‡¶®‡¶∞‡ßã‡¶≤
                                        </a>
                                    </div>
                                    <% }) %>
                                        <% } else { %>
                                            <div
                                                class="p-8 text-center bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800">
                                                <p class="text-slate-400 text-sm">‡¶Ü‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶∞‡ßç‡¶∏ ‡¶®‡ßá‡¶á</p>
                                            </div>
                                            <% } %>
                        </div>
                    </div>

                </div>

                <!-- Column 2: Progress Graph (1/3 width) -->
                <div class="lg:col-span-1">
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm h-full flex flex-col">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶´</h3>

                        <div class="flex-1 min-h-[250px] relative">
                            <canvas id="progressChart"></canvas>
                        </div>

                        <div class="mt-6 text-center">
                            <p class="text-xs text-slate-400 mb-1">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶ú‡¶ø‡¶§ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</p>
                            <p class="text-3xl font-black text-primary dark:text-white">
                                <%= (user.quizResults || []).reduce((acc, curr)=> acc + (curr.score || 0), 0) %>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Mobile Bottom Nav -->
    <nav
        class="fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-[#0B1120] border-t border-slate-200 dark:border-slate-800 flex items-center justify-around lg:hidden z-50 pb-safe">
        <a href="/dashboard"
            class="flex flex-col items-center justify-center w-full h-full text-slate-900 dark:text-white">
            <span class="material-symbols-outlined text-2xl">dashboard</span>
        </a>
        <a href="/courses"
            class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors">
            <span class="material-symbols-outlined text-2xl">school</span>
        </a>
        <div class="relative -top-5">
            <a href="/ai-chat"
                class="size-14 bg-slate-900 text-white rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform">
                <span class="material-symbols-outlined text-2xl">smart_toy</span>
            </a>
        </div>
        <a href="/routine"
            class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors">
            <span class="material-symbols-outlined text-2xl">calendar_month</span>
        </a>
        <a href="/profile"
            class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors">
            <span class="material-symbols-outlined text-2xl">person</span>
        </a>
    </nav>

    <script>
        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full', 'hidden');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.add('-translate-x-full');
                setTimeout(() => sidebar.classList.add('hidden'), 300);
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        // Dark Mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        // Initialize Chart
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('progressChart').getContext('2d');

            // Dummy Data generation for now if needed, or use actual
            // Ideally passing explicit data via EJS variable
            <% 
               const chartData = (user.quizResults || []).map(q => q.score).slice(-5);
            const chartLabels = (user.quizResults || []).map((q, i) => `Quiz ${i + 1}`).slice(-5);
            %>
            
            const data = {
                labels: <% - JSON.stringify(chartLabels.length ? chartLabels : ['Q1', 'Q2', 'Q3', 'Q4', 'Q5']) %>,
                datasets: [{
                    label: 'Score',
                    data: <% - JSON.stringify(chartData.length ? chartData : [0, 0, 0, 0, 0]) %>, // Use actual data
                    borderColor: '#2563EB',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2563EB',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    fill: true
                }]
            };

            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: false, drawBorder: false },
                            ticks: { display: false }
                        },
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: {
                                font: { size: 10 },
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            };

            new Chart(ctx, config);
        });
    </script>
</body>

</html>