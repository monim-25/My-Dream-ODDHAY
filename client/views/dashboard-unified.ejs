<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü | ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</title>
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'Hind Siliguri', 'sans-serif'],
                    },
                    colors: {
                        primary: '#1e293b',
                        accent: '#3b82f6',
                        background: {
                            light: '#f8fafc',
                            dark: '#020617'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Hind Siliguri', 'Outfit', sans-serif;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .dark .glass-effect {
            background: rgba(15, 23, 42, 0.85);
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .sidebar-active {
            background: #eff6ff;
            color: #2563eb;
            font-weight: 700;
        }

        .dark .sidebar-active {
            background: rgba(30, 41, 59, 0.5);
            color: #60a5fa;
        }
    </style>
</head>

<body
    class="bg-background-light text-slate-900 dark:bg-background-dark dark:text-slate-100 min-h-screen transition-colors duration-300">

    <!-- Top Navbar -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass-effect border-b border-slate-200 dark:border-slate-800 h-16">
        <div class="max-w-[1440px] mx-auto px-4 lg:px-6 h-full flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()"
                    class="lg:hidden p-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-all active:scale-90 z-[60]">
                    <span class="material-symbols-outlined text-2xl pointer-events-none">menu</span>
                </button>
                <a href="/" class="flex items-center gap-2 group">
                    <div class="text-primary transform group-hover:rotate-12 transition-transform duration-300">
                        <svg class="size-7" fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <span
                        class="text-2xl font-black tracking-tighter text-slate-800 dark:text-white uppercase">ODDHAY</span>
                </a>
            </div>

            <div class="flex items-center gap-3 lg:gap-5">
                <!-- Notifications -->
                <button
                    class="p-2 lg:p-2.5 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors relative group">
                    <span
                        class="material-symbols-outlined text-[28px] lg:text-[32px] text-slate-600 dark:text-slate-400 group-hover:text-accent transition-colors">notifications</span>
                    <% if(notifications && notifications.length> 0) { %>
                        <span
                            class="absolute top-2 lg:top-2.5 right-2 lg:right-2.5 size-2 lg:size-2.5 bg-red-500 rounded-full border-2 border-white dark:border-slate-900"></span>
                        <% } %>
                </button>
                <!-- Profile Link (Hidden on Mobile Header) -->
                <a href="/profile"
                    class="hidden lg:block size-11 rounded-full overflow-hidden border-2 border-white dark:border-slate-800 shadow-sm hover:ring-2 ring-accent transition-all shrink-0">
                    <img src="<%= user.profileImage || `https://ui-avatars.com/api/?name=${user.name}&background=random` %>"
                        class="w-full h-full object-cover">
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div id="sidebar-overlay" onclick="toggleSidebar()"
        class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-30 hidden lg:hidden"></div>
    <aside id="sidebar"
        class="fixed top-0 lg:top-16 left-0 bottom-0 w-72 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 shadow-2xl lg:shadow-none">
        <div class="h-full flex flex-col p-4 lg:p-6 overflow-y-auto">

            <div class="flex items-center justify-between lg:hidden mb-8">
                <span class="text-xl font-black">‡¶Æ‡ßá‡¶®‡ßÅ</span>
                <button onclick="toggleSidebar()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="space-y-1">
                <a href="/dashboard" class="flex items-center gap-3.5 px-4 py-3 rounded-2xl sidebar-active">
                    <span class="material-symbols-outlined">home</span> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
                </a>
                <button onclick="toggleSettings(); toggleSidebar()"
                    class="w-full flex items-center gap-3.5 px-4 py-3 rounded-2xl text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">settings</span> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                </button>
                <a href="/courses"
                    class="flex items-center gap-3.5 px-4 py-3 rounded-2xl text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">school</span> ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶∞‡ßç‡¶∏
                </a>
                <a href="/routine"
                    class="flex items-center gap-3.5 px-4 py-3 rounded-2xl text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">calendar_month</span> ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®
                </a>
                <a href="/analytics"
                    class="flex items-center gap-3.5 px-4 py-3 rounded-2xl text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">analytics</span> ‡¶è‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶∏
                </a>
                <a href="/leaderboard"
                    class="flex items-center gap-3.5 px-4 py-3 rounded-2xl text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">leaderboard</span> ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°
                </a>
                <a href="/contact"
                    class="flex items-center gap-3.5 px-4 py-3 rounded-2xl text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">chat_bubble</span> ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó
                </a>
            </div>

            <div class="mt-auto pt-6 border-t border-slate-100 dark:border-slate-800">
                <a href="/logout"
                    class="flex items-center gap-3.5 px-4 py-3 rounded-2xl text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors font-black">
                    <span class="material-symbols-outlined">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
                </a>
            </div>
        </div>
    </aside>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-[100] flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm" onclick="toggleSettings()"></div>
        <div
            class="bg-white dark:bg-slate-900 w-[320px] rounded-3xl p-6 shadow-2xl relative z-10 border border-slate-200 dark:border-slate-800 anim-fade-in">
            <h2 class="text-xl font-black mb-6 flex items-center gap-2">
                <span class="material-symbols-outlined">settings_adjust</span> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
            </h2>
            <div class="space-y-6">
                <!-- Theme -->
                <div>
                    <label class="text-xs font-black text-slate-400 uppercase mb-3 block">‡¶•‡¶ø‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="setTheme('light')"
                            class="flex items-center justify-center gap-2 p-3 rounded-xl border border-slate-200 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all font-bold text-sm">
                            <span class="material-symbols-outlined text-lg">light_mode</span> ‡¶≤‡¶æ‡¶á‡¶ü
                        </button>
                        <button onclick="setTheme('dark')"
                            class="flex items-center justify-center gap-2 p-3 rounded-xl border border-slate-200 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all font-bold text-sm">
                            <span class="material-symbols-outlined text-lg">dark_mode</span> ‡¶°‡¶æ‡¶∞‡ßç‡¶ï
                        </button>
                    </div>
                </div>
                <!-- Language -->
                <div>
                    <label class="text-xs font-black text-slate-400 uppercase mb-3 block">‡¶≠‡¶æ‡¶∑‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</label>
                    <select
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent font-bold text-sm active:ring-accent outline-none">
                        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            <button onclick="toggleSettings()"
                class="w-full mt-8 p-4 bg-slate-900 dark:bg-accent text-white rounded-2xl font-black shadow-lg">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
                ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="lg:ml-72 pt-16 min-h-screen px-4 lg:px-6 pb-24">
        <div class="max-w-[1200px] mx-auto pt-6 space-y-6">

            <!-- Welcome Banner -->
            <div
                class="bg-white dark:bg-slate-900 rounded-[2rem] lg:rounded-[2.5rem] p-5 lg:p-8 border border-slate-200 dark:border-slate-800 shadow-sm relative overflow-hidden">
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center gap-4 lg:gap-8">
                        <div
                            class="size-16 lg:size-32 rounded-2xl lg:rounded-[2rem] overflow-hidden ring-2 lg:ring-4 ring-slate-100 dark:ring-slate-800 shadow-lg shrink-0">
                            <img src="<%= user.profileImage || `https://ui-avatars.com/api/?name=${user.name}&background=random` %>"
                                class="w-full h-full object-cover">
                        </div>
                        <div class="text-left">
                            <h1 class="text-xl lg:text-4xl font-black tracking-tight mb-1 lg:mb-2">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, <%=
                                    user.name %>!</h1>
                            <p class="hidden lg:block text-slate-500 dark:text-slate-400 font-medium max-w-xl">
                                ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßú‡¶æ‡¶∂‡ßã‡¶®‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì ‡¶è‡¶¨‡¶Ç ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∂‡¶ø‡¶ñ‡ßã‡•§ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ü‡¶ø ‡¶π‡ßã‡¶ï ‡¶∏‡¶´‡¶≤‡¶§‡¶æ‡¶∞! üöÄ
                            </p>
                            <p class="lg:hidden text-xs text-slate-500 font-bold uppercase tracking-widest">
                                <%= user.classLevel %> ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏
                            </p>
                        </div>
                    </div>

                    <!-- Next Update Inline (Visible on all screens in banner) -->
                    <div class="flex flex-col items-end text-right">
                        <p
                            class="text-[9px] lg:text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] leading-none mb-1 lg:mb-2">
                            ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</p>
                        <p
                            class="text-[11px] lg:text-sm font-black text-accent max-w-[120px] lg:max-w-none truncate leading-tight">
                            <% if(routineTasks && routineTasks.length> 0) { %>
                                <%= routineTasks[0].title %>
                                    <% } else { %>
                                        ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßá‡¶∂‡¶®
                                        <% } %>
                        </p>
                        <% if(routineTasks && routineTasks.length> 0) { %>
                            <p class="text-[9px] lg:text-xs font-bold text-slate-400 mt-0.5">
                                <%= routineTasks[0].time %>
                            </p>
                            <% } %>
                    </div>
                </div>
            </div>

            <!-- Quick Services (Expanded) -->
            <div
                class="bg-white dark:bg-slate-900 p-8 rounded-[3rem] border border-slate-200 dark:border-slate-800 shadow-sm">
                <h2 class="text-xl font-black mb-10 flex items-center justify-between">
                    ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                    <a href="/courses"
                        class="flex flex-col items-center gap-4 p-5 rounded-[2.5rem] hover:bg-blue-50 dark:hover:bg-blue-900/20 border border-slate-100 dark:border-slate-800 hover:border-blue-200 transition-all group">
                        <div
                            class="size-16 md:size-20 rounded-3xl bg-blue-500 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-4xl">class</span>
                        </div>
                        <span class="font-bold text-sm">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏</span>
                    </a>
                    <a href="/exams"
                        class="flex flex-col items-center gap-4 p-5 rounded-[2.5rem] hover:bg-red-50 dark:hover:bg-red-900/20 border border-slate-100 dark:border-slate-800 hover:border-red-200 transition-all group">
                        <div
                            class="size-16 md:size-20 rounded-3xl bg-red-500 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-4xl">edit_document</span>
                        </div>
                        <span class="font-bold text-sm">‡¶è‡¶ï‡ßç‡¶∏‡¶æ‡¶Æ</span>
                    </a>
                    <a href="/notes"
                        class="flex flex-col items-center gap-4 p-5 rounded-[2.5rem] hover:bg-amber-50 dark:hover:bg-amber-900/20 border border-slate-100 dark:border-slate-800 hover:border-amber-200 transition-all group">
                        <div
                            class="size-16 md:size-20 rounded-3xl bg-amber-500 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-4xl">description</span>
                        </div>
                        <span class="font-bold text-sm">‡¶®‡ßã‡¶ü‡¶∏</span>
                    </a>
                    <a href="/ai-chat"
                        class="flex flex-col items-center gap-4 p-5 rounded-[2.5rem] hover:bg-purple-50 dark:hover:bg-purple-900/20 border border-slate-100 dark:border-slate-800 hover:border-purple-200 transition-all group">
                        <div
                            class="size-16 md:size-20 rounded-3xl bg-purple-500 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-4xl">magic_button</span>
                        </div>
                        <span class="font-bold text-sm">AI ‡¶ü‡¶ø‡¶â‡¶ü‡¶∞</span>
                    </a>
                    <a href="/qa"
                        class="flex flex-col items-center gap-4 p-5 rounded-[2.5rem] hover:bg-indigo-50 dark:hover:bg-indigo-900/20 border border-slate-100 dark:border-slate-800 hover:border-indigo-200 transition-all group">
                        <div
                            class="size-16 md:size-20 rounded-3xl bg-indigo-500 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-4xl">chat_bubble</span>
                        </div>
                        <span class="font-bold text-sm">Q&A</span>
                    </a>
                    <a href="/question-bank"
                        class="flex flex-col items-center gap-4 p-5 rounded-[2.5rem] hover:bg-rose-50 dark:hover:bg-rose-900/20 border border-slate-100 dark:border-slate-800 hover:border-rose-200 transition-all group">
                        <div
                            class="size-16 md:size-20 rounded-3xl bg-rose-500 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-4xl">library_books</span>
                        </div>
                        <span class="font-bold text-sm">‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∂‡ßç‡¶ö‡ßá‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï</span>
                    </a>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Dashboard Center Content -->
                <div class="grid grid-cols-1 gap-6">
                    <!-- Continue Learning Card ... kept as it was -->
                </div>
            </div>

            <!-- Continue Learning & Enrolled Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Continue Learning -->
                <div
                    class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm">
                    <h2
                        class="text-sm font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                        <span class="material-symbols-outlined text-accent text-lg">play_circle</span> ‡¶∂‡ßá‡¶ñ‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®
                    </h2>
                    <% if(user.lastWatchedLesson && user.lastWatchedLesson.course) { %>
                        <div class="flex gap-5">
                            <div
                                class="w-40 aspect-video rounded-2xl bg-slate-100 dark:bg-slate-800 overflow-hidden shrink-0 shadow-md">
                                <img src="<%= user.lastWatchedLesson.course.thumbnail %>"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-800 dark:text-white line-clamp-1">
                                    <%= user.lastWatchedLesson.lessonTitle %>
                                </h4>
                                <p class="text-xs text-slate-500 mt-1 mb-4">
                                    <%= user.lastWatchedLesson.course.title %>
                                </p>
                                <a href="/course-details/<%= user.lastWatchedLesson.course._id %>"
                                    class="px-5 py-2.5 bg-accent text-white rounded-xl text-xs font-black shadow-lg shadow-accent/20">‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá
                                    ‡¶Ø‡¶æ‡¶®</a>
                            </div>
                        </div>
                        <% } else { %>
                            <div
                                class="py-6 text-center border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-2xl">
                                <p class="text-slate-400 text-xs">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</p>
                            </div>
                            <% } %>
                </div>

                <!-- Enrolled Box (Moved here beside Continue Learning) -->
                <div
                    class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm">
                    <h2
                        class="text-sm font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                        <span class="material-symbols-outlined text-emerald-500 text-lg">fact_check</span> ‡¶è‡¶®‡¶∞‡ßã‡¶≤ ‡¶ï‡¶∞‡¶æ
                        ‡¶ï‡ßã‡¶∞‡ßç‡¶∏
                    </h2>
                    <div
                        class="flex items-center justify-between p-6 bg-slate-50 dark:bg-slate-800/50 rounded-3xl border border-slate-100 dark:border-slate-800">
                        <div>
                            <p class="text-4xl font-black text-slate-800 dark:text-white">
                                <%= user.enrolledCourses ? user.enrolledCourses.length : 0 %>
                            </p>
                            <p class="text-xs font-bold text-slate-400 mt-1 uppercase tracking-widest">‡¶Æ‡ßã‡¶ü ‡¶ï‡ßã‡¶∞‡ßç‡¶∏</p>
                        </div>
                        <a href="/my-courses"
                            class="size-14 bg-white dark:bg-slate-800 rounded-2xl flex items-center justify-center text-slate-800 dark:text-white shadow-md border border-slate-100 dark:border-slate-700 hover:scale-105 transition-transform">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Dual Section: Routine & Subjective Report -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Task List -->
                <div
                    class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
                    <div class="flex items-center justify-between mb-8">
                        <h2 class="text-xl font-black flex items-center gap-3">
                            <span class="material-symbols-outlined text-blue-500 text-3xl">task_alt</span> ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®
                        </h2>
                        <a href="/routine"
                            class="px-6 py-2.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-2xl text-xs font-black hover:bg-accent hover:text-white transition-all">‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã</a>
                    </div>
                    <div class="space-y-4 flex-1">
                        <% if(routineTasks && routineTasks.length> 0) { %>
                            <% routineTasks.slice(0, 3).forEach(task=> { %>
                                <div
                                    class="flex items-center gap-4 p-4 rounded-3xl bg-slate-50 dark:bg-slate-800/30 border border-slate-50 dark:border-slate-800 group hover:border-accent/20 transition-all">
                                    <div
                                        class="size-10 rounded-2xl bg-blue-100 dark:bg-blue-900/30 text-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <span class="material-symbols-outlined">event_available</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-bold text-sm">
                                            <%= task.title %>
                                        </p>
                                        <p class="text-[10px] text-slate-400 font-bold uppercase">
                                            <%= task.time || '‡¶∏‡¶Æ‡ßü ‡¶®‡ßá‡¶á' %>
                                        </p>
                                    </div>
                                    <input type="checkbox"
                                        class="size-6 rounded-lg border-2 border-slate-200 dark:border-slate-700 accent-accent cursor-pointer">
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <div
                                            class="py-12 text-center text-slate-400 bg-slate-50 dark:bg-slate-800/20 rounded-3xl">
                                            <span
                                                class="material-symbols-outlined text-4xl mb-2 opacity-20">event_busy</span>
                                            <p class="text-sm font-bold">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á</p>
                                        </div>
                                        <% } %>
                    </div>
                    <button
                        class="w-full mt-6 py-3 bg-accent text-white rounded-2xl font-black shadow-lg shadow-accent/20 flex items-center justify-center gap-2 hover:scale-105 transition-all text-sm">
                        <span class="material-symbols-outlined text-lg">update</span> ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>

                <!-- Subjective Report -->
                <div
                    class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm">
                    <h2 class="text-xl font-black mb-8 flex items-center gap-3 text-slate-800 dark:text-white">
                        <span class="material-symbols-outlined text-rose-500 text-3xl">bar_chart_4_bars</span>
                        ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    </h2>
                    <div class="space-y-6">
                        <% ['‡¶ó‡¶£‡¶ø‡¶§', '‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®' , '‡¶∞‡¶∏‡¶æ‡ßü‡¶®' ].forEach(sub=> { %>
                            <div class="space-y-3">
                                <div class="flex justify-between items-end">
                                    <p class="font-black text-sm">
                                        <%= sub %>
                                    </p>
                                    <p class="text-[10px] font-black text-rose-500">‡ßÆ‡ß´% ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£</p>
                                </div>
                                <div class="h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-rose-500 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                            <% }) %>
                                <div class="pt-4">
                                    <a href="/analytics"
                                        class="block w-full text-center py-4 border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-3xl text-xs font-black text-slate-400 hover:text-accent hover:border-accent/30 transition-all">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§
                                        ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>
                                </div>
                    </div>
                </div>
            </div>

            <!-- Courses (Full Width) -->
            <div
                class="bg-white dark:bg-slate-900 p-8 lg:p-12 rounded-[4rem] border border-slate-200 dark:border-slate-800 shadow-xl overflow-hidden relative">
                <div class="absolute -right-20 -top-20 size-60 bg-accent/5 rounded-full blur-3xl"></div>
                <div class="flex flex-col sm:flex-row items-center justify-between mb-12 gap-6 relative z-10">
                    <h2
                        class="text-3xl font-black tracking-tighter text-slate-800 dark:text-white flex items-center gap-4">
                        <span class="size-3 bg-accent rounded-full animate-pulse"></span> Courses
                    </h2>
                    <a href="/courses"
                        class="px-6 py-2.5 bg-accent text-white rounded-2xl text-xs font-black shadow-lg shadow-accent/20 hover:scale-105 transition-all whitespace-nowrap">‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã
                        ‡¶ï‡ßã‡¶∞‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 relative z-10">
                    <% if(recommendations && recommendations.length> 0) { %>
                        <% recommendations.forEach(course=> { %>
                            <a href="/course-details/<%= course._id %>"
                                class="group block bg-slate-50 dark:bg-slate-800/40 rounded-[3rem] p-6 border border-slate-100 dark:border-slate-800 hover:border-accent/40 hover:shadow-2xl hover:shadow-accent/5 transition-all duration-500">
                                <div
                                    class="aspect-[16/10] rounded-[2.5rem] overflow-hidden mb-6 shadow-lg bg-slate-200 relative">
                                    <img src="<%= course.thumbnail %>"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                    <div
                                        class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                                    </div>
                                </div>
                                <h4
                                    class="text-xl font-black text-slate-800 dark:text-white mb-2 group-hover:text-accent transition-colors">
                                    <%= course.title %>
                                </h4>
                                <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-8">
                                    <%= course.subject %>
                                </p>
                                <div
                                    class="flex items-center justify-between pt-6 border-t border-slate-200 dark:border-slate-700">
                                    <div class="flex items-center gap-2">
                                        <div
                                            class="size-8 rounded-xl bg-accent/10 flex items-center justify-center text-accent">
                                            <span class="material-symbols-outlined text-lg">verified</span>
                                        </div>
                                        <span
                                            class="text-xs font-black text-slate-600 dark:text-slate-400">OFFICIAL</span>
                                    </div>
                                    <span
                                        class="px-5 py-2.5 bg-slate-900 dark:bg-accent text-white rounded-xl text-xs font-black shadow-lg">‡¶è‡¶®‡¶∞‡ßã‡¶≤</span>
                                </div>
                            </a>
                            <% }) %>
                                <% } else { %>
                                    <div
                                        class="col-span-full py-20 text-center bg-slate-50 dark:bg-slate-800/20 rounded-[3rem] border border-dashed border-slate-200 dark:border-slate-700">
                                        <span
                                            class="material-symbols-outlined text-5xl mb-4 text-slate-300">school</span>
                                        <p class="text-slate-400 font-bold">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶∞‡ßç‡¶∏ ‡¶®‡ßá‡¶á</p>
                                    </div>
                                    <% } %>
                </div>
            </div>

            <!-- Bottom Section: Graph & Leaderboard -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Progress Graph (Large) -->
                <div
                    class="lg:col-span-2 bg-white dark:bg-slate-900 p-8 lg:p-10 rounded-[3rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
                    <h2 class="text-2xl font-black mb-8 flex items-center gap-3">
                        <span class="material-symbols-outlined text-accent text-3xl">insights</span> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø
                    </h2>
                    <div class="flex-1 min-h-[300px] relative">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>

                <!-- Leaderboard (Beside Graph) -->
                <div
                    class="bg-white dark:bg-slate-900 p-8 rounded-[3rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
                    <h2 class="text-xl font-black mb-8 flex items-center gap-3">
                        <span class="material-symbols-outlined text-amber-500 text-3xl">military_tech</span> ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°
                    </h2>
                    <div class="space-y-2 flex-1">
                        <% if(leaderboard && leaderboard.length> 0) { %>
                            <% leaderboard.slice(0, 5).forEach((item, index)=> { %>
                                <div
                                    class="flex items-center gap-4 p-4 rounded-3xl hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all border border-transparent hover:border-slate-100 dark:hover:border-slate-800 <%= index === 0 ? 'bg-amber-500/5 border-amber-500/10' : '' %>">
                                    <div
                                        class="size-10 rounded-2xl <%= index === 0 ? 'bg-amber-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-500' %> flex items-center justify-center font-black text-sm">
                                        #<%= index + 1 %>
                                    </div>
                                    <div class="flex-1 overflow-hidden">
                                        <p class="font-black text-sm truncate">
                                            <%= item.name %>
                                        </p>
                                        <p class="text-[9px] text-slate-400 font-black uppercase">
                                            <%= item.classLevel %>
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-black text-accent text-sm">
                                            <%= item.totalScore %>
                                        </p>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p class="text-center text-slate-400 text-sm py-12">‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á</p>
                                        <% } %>
                    </div>
                    <a href="/leaderboard"
                        class="mt-6 block w-full text-center py-4 bg-slate-50 dark:bg-slate-800/50 rounded-2xl text-[10px] font-black text-slate-400 hover:text-accent uppercase tracking-[0.2em] transition-all">‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°
                        ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>
                </div>
            </div>

        </div>
    </main>

    <!-- Mobile Bottom Nav -->
    <nav
        class="fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 flex items-center justify-around lg:hidden z-50 pb-safe shadow-[0_-8px_30px_rgb(0,0,0,0.12)] bg-opacity-95 backdrop-blur-md">
        <a href="/dashboard" class="flex flex-col items-center justify-center w-full h-full text-accent transition-all">
            <span class="material-symbols-outlined text-[26px] font-bold">home</span>
            <span class="text-[9px] font-black uppercase mt-0.5 tracking-tight">‡¶π‡ßã‡¶Æ</span>
        </a>
        <a href="/messages"
            class="flex flex-col items-center justify-center w-full h-full text-slate-400 active:text-accent transition-all">
            <span class="material-symbols-outlined text-[26px]">forum</span>
            <span class="text-[9px] font-black uppercase mt-0.5 tracking-tight">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</span>
        </a>
        <a href="/downloads"
            class="flex flex-col items-center justify-center w-full h-full text-slate-400 active:text-accent transition-all">
            <span class="material-symbols-outlined text-[26px]">download</span>
            <span class="text-[9px] font-black uppercase mt-0.5 tracking-tight">‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</span>
        </a>
        <a href="/profile"
            class="flex flex-col items-center justify-center w-full h-full text-slate-400 active:text-accent transition-all">
            <span class="material-symbols-outlined text-[26px]">person</span>
            <span class="text-[9px] font-black uppercase mt-0.5 tracking-tight">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span>
        </a>
    </nav>

    <script>
        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (!sidebar || !overlay) return;
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }
        window.toggleSidebar = toggleSidebar;

        // Settings Modal
        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            if (modal) modal.classList.toggle('hidden');
        }

        function closeWelcome() {
            const overlay = document.getElementById('welcome-overlay');
            if (overlay) overlay.style.display = 'none';
        }

        function setTheme(theme) {
            if (theme === 'dark') document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', theme);
        }

        // Chart Init
        document.addEventListener('DOMContentLoaded', () => {
            const ctx = document.getElementById('progressChart').getContext('2d');
            <% 
               const graphData = (user.quizResults || []).map(q => q.score).slice(-7);
            const graphLabels = (user.quizResults || []).map((_, i) => `Test ${i + 1}`).slice(-7);
            %>
            const data = {
                labels: <% - JSON.stringify(graphLabels.length ? graphLabels : ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5']) %>,
                datasets: [{
                    label: 'Score',
                    data: <% - JSON.stringify(graphData.length ? graphData : [10, 25, 15, 45, 30]) %>,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 5,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 6,
                    pointBackgroundColor: '#fff',
                    pointBorderWidth: 4,
                }]
            };
            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)', drawBorder: false },
                            ticks: { display: false }
                        },
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: { font: { family: 'Outfit', weight: 'bold' } }
                        }
                    }
                }
            });
        });

        // Auto Dark Mode
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        }
    </script>

    <!-- First Visit Alert Overlay -->
    <% if (locals.isFirstLogin) { %>
        <div id="welcome-overlay"
            class="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900/80 backdrop-blur-xl anim-fade-in">
            <div
                class="text-center p-10 bg-white dark:bg-slate-900 rounded-[4rem] shadow-2xl max-w-md border border-slate-200 dark:border-slate-800 mx-4 transform scale-100 transition-transform">
                <div
                    class="size-24 bg-accent/10 text-accent rounded-[2rem] flex items-center justify-center mx-auto mb-8">
                    <span class="material-symbols-outlined text-5xl">celebration</span>
                </div>
                <h2 class="text-3xl font-black mb-4">‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü-‡¶è ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
                <p class="text-slate-500 dark:text-slate-400 text-sm mb-10 leading-relaxed font-medium">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡ßá‡¶ñ‡¶æ‡¶∞
                    ‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶¨ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶Ü‡¶ú‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶´‡¶≤‡ßç‡¶Ø‡ßá‡¶∞ ‡¶™‡¶•‡ßá ‡¶è‡¶ï ‡¶ß‡¶æ‡¶™
                    ‡¶è‡¶ó‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®‡•§</p>
                <button onclick="closeWelcome()"
                    class="w-full py-5 bg-accent text-white rounded-[2rem] font-black shadow-2xl shadow-accent/40 hover:scale-105 transition-all active:scale-95">‡¶∂‡ßÅ‡¶∞‡ßÅ
                    ‡¶ï‡¶∞‡¶ø!</button>
            </div>
        </div>

        <script>
            function closeWelcome() {
                const overlay = document.getElementById('welcome-overlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                }
            }
        </script>
        <% } %>

</body>

</html>

</html>