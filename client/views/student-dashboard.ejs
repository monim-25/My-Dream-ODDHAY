<!DOCTYPE html>
<html class="light" lang="bn">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° | ODDHAY</title>
    <%- include('partials/head') %>
        <style>
            .sidebar-item-active {
                background: linear-gradient(90deg, rgba(19, 127, 236, 0.1) 0%, transparent 100%);
                border-left: 4px solid var(--primary);
                color: var(--primary) !important;
            }

            .progress-ring__circle {
                transition: stroke-dashoffset 0.35s;
                transform: rotate(-90deg);
                transform-origin: 50% 50%;
            }
        </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 flex min-h-screen">
    <!-- Sidebar overlay for mobile -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="main-sidebar"
        class="fixed lg:sticky top-0 left-0 w-72 border-r border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 z-50 h-screen transition-transform duration-300 -translate-x-full lg:translate-x-0 flex flex-col">
        <div class="p-8">
            <div class="flex items-center justify-between mb-12">
                <a href="/" class="flex items-center gap-2 group">
                    <div class="text-primary transform group-hover:rotate-12 transition-transform duration-300">
                        <svg class="size-8" fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-black tracking-tighter">ODDHAY</h1>
                </a>
                <button class="lg:hidden p-2 text-slate-400" onclick="toggleSidebar()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <nav class="space-y-2">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4 px-4">‡¶Æ‡ßá‡¶®‡ßÅ</p>
                <a href="/dashboard"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl sidebar-item-active font-bold transition-all">
                    <span class="material-symbols-outlined text-xl">dashboard</span> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
                </a>
                <a href="/courses"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold">
                    <span class="material-symbols-outlined text-xl">school</span> ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶∏‡¶Æ‡ßÇ‡¶π
                </a>
                <a href="/feature/recorded"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold">
                    <span class="material-symbols-outlined text-xl">play_circle</span> ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏
                </a>
                <a href="/feature/live"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold">
                    <span class="material-symbols-outlined text-xl">live_tv</span> ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏
                </a>

                <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-8 mb-4 px-4">‡¶∞‡¶ø‡¶∏‡ßã‡¶∞‡ßç‡¶∏</p>
                <a href="/feature/notes"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold">
                    <span class="material-symbols-outlined text-xl">description</span> ‡¶≤‡ßá‡¶ï‡¶ö‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü‡¶∏
                </a>
                <a href="/library"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold">
                    <span class="material-symbols-outlined text-xl">local_library</span> ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø
                </a>
                <a href="/create-self-quiz"
                    class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold">
                    <span class="material-symbols-outlined text-xl">quiz</span> ‡¶∏‡ßá‡¶≤‡¶´ ‡¶Æ‡¶ï ‡¶ü‡ßá‡¶∏‡ßç‡¶ü
                </a>
            </nav>
        </div>

        <div class="mt-auto p-8 border-t border-slate-100 dark:border-slate-800">
            <a href="/logout"
                class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-all font-black text-sm">
                <span class="material-symbols-outlined text-xl">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-8 lg:p-12 max-w-7xl mx-auto w-full">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
            <div class="flex items-center gap-4 w-full md:w-auto">
                <button
                    class="lg:hidden size-12 flex items-center justify-center rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm"
                    onclick="toggleSidebar()">
                    <span class="material-symbols-outlined text-2xl">menu</span>
                </button>
                <div class="reveal">
                    <h2 class="text-3xl font-black mb-1">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, <%= user ? user.name : '‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ' %>! üëã</h2>
                    <p class="text-slate-500 font-bold text-sm">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ ‡¶π‡ßã‡¶ï ‡¶Ü‡¶®‡¶®‡ßç‡¶¶‡¶Æ‡ßü‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶§‡•§</p>
                </div>
            </div>
            <div class="flex items-center gap-4 reveal">
                <button
                    class="size-12 rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm flex items-center justify-center text-slate-500 hover:text-primary transition-all"
                    onclick="document.documentElement.classList.toggle('dark')">
                    <span class="material-symbols-outlined block dark:hidden">dark_mode</span>
                    <span class="material-symbols-outlined hidden dark:block text-amber-400">light_mode</span>
                </button>
                <a href="/profile"
                    class="flex items-center gap-3 p-1.5 pr-6 rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm hover:border-primary transition-all group">
                    <div class="size-10 rounded-xl bg-primary text-white flex items-center justify-center font-black">
                        <%= user ? user.name[0] : 'S' %>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase leading-none mb-1">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
                        <p class="text-sm font-black truncate max-w-[120px]">
                            <%= user ? user.name : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü' %>
                        </p>
                    </div>
                </a>
            </div>
        </header>

        <!-- Parent/Alerts Section -->
        <% if (user && user.parentRequests && user.parentRequests.some(r=> r.status === 'pending')) { %>
            <div
                class="mb-10 p-6 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-3xl flex flex-col md:flex-row justify-between items-center gap-6 reveal">
                <div class="flex items-center gap-4 text-center md:text-left">
                    <div
                        class="size-14 rounded-2xl bg-amber-100 dark:bg-amber-900/40 text-amber-600 flex items-center justify-center shrink-0">
                        <span class="material-symbols-outlined text-3xl">family_restroom</span>
                    </div>
                    <div>
                        <h4 class="font-black text-amber-900 dark:text-amber-200">‡¶Ö‡¶≠‡¶ø‡¶≠‡¶æ‡¶¨‡¶ï ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß</h4>
                        <p class="text-sm text-amber-700 dark:text-amber-400 font-bold">‡¶è‡¶ï‡¶ú‡¶® ‡¶Ö‡¶≠‡¶ø‡¶≠‡¶æ‡¶¨‡¶ï ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßú‡¶æ‡¶∂‡ßã‡¶®‡¶æ‡¶∞
                            ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§</p>
                    </div>
                </div>
                <div class="flex flex-wrap gap-3">
                    <% user.parentRequests.filter(r=> r.status === 'pending').forEach(request => { %>
                        <div
                            class="flex items-center gap-4 px-4 py-2 bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-amber-200">
                            <span class="text-xs font-black">
                                <%= request.parent.name %>
                            </span>
                            <div class="flex gap-2">
                                <form action="/student/approve-parent/<%= request.parent._id %>" method="POST">
                                    <button type="submit"
                                        class="size-8 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 transition-all flex items-center justify-center shadow-lg shadow-emerald-500/20">
                                        <span class="material-symbols-outlined text-lg">check</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                        <% }); %>
                </div>
            </div>
            <% } %>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                    <div
                        class="card-smart !bg-primary !text-white flex items-center gap-6 group hover:translate-y-[-8px] transition-all reveal">
                        <div class="size-16 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center">
                            <span class="material-symbols-outlined text-3xl">auto_stories</span>
                        </div>
                        <div>
                            <h3 class="text-3xl font-black mb-1">
                                <%= user ? user.completedLessons.length : 0 %>
                            </h3>
                            <p class="text-sm font-bold text-white/80 uppercase tracking-widest leading-none">‡¶≤‡ßá‡¶∏‡¶®
                                ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</p>
                        </div>
                    </div>
                    <div
                        class="card-smart flex items-center gap-6 group hover:translate-y-[-8px] transition-all reveal delay-100">
                        <div
                            class="size-16 rounded-2xl bg-amber-500/10 text-amber-600 flex items-center justify-center">
                            <span class="material-symbols-outlined text-3xl">emoji_events</span>
                        </div>
                        <div>
                            <h3 class="text-3xl font-black mb-1">
                                <%= user ? user.quizResults.length : 0 %>
                            </h3>
                            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest leading-none">
                                ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶ï‡ßÉ‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</p>
                        </div>
                    </div>
                    <div
                        class="card-smart flex items-center gap-6 group hover:translate-y-[-8px] transition-all reveal delay-200">
                        <div
                            class="size-16 rounded-2xl bg-emerald-500/10 text-emerald-600 flex items-center justify-center">
                            <span class="material-symbols-outlined text-3xl">trending_up</span>
                        </div>
                        <div>
                            <h3 class="text-3xl font-black mb-1">‡ßÆ‡ß´%</h3>
                            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest leading-none">‡¶∏‡¶æ‡¶´‡¶≤‡ßç‡¶Ø‡ßá‡¶∞
                                ‡¶π‡¶æ‡¶∞</p>
                        </div>
                    </div>
                </div>

                <!-- Enrolled Courses -->
                <section class="mb-16 reveal delay-300">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="h2-section !text-xl">‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®</h3>
                        <a href="/courses" class="btn-secondary !py-2 !px-4 !text-xs">‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡ßã‡¶∞‡ßç‡¶∏</a>
                    </div>

                    <% if (user && user.enrolledCourses && user.enrolledCourses.length> 0) { %>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
                            <% user.enrolledCourses.forEach(enrollment=> {
                                const course = enrollment.course;
                                if (!course) return;
                                %>
                                <div class="card-smart !p-0 flex flex-col sm:flex-row overflow-hidden group">
                                    <div class="w-full sm:w-48 aspect-video sm:aspect-square relative shrink-0">
                                        <img src="<%= course.thumbnail || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&q=80&w=800' %>"
                                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                        <div
                                            class="absolute inset-0 bg-primary/20 opacity-0 group-hover:opacity-100 transition-opacity">
                                        </div>
                                    </div>
                                    <div class="p-6 flex-1 flex flex-col justify-center">
                                        <div class="flex items-center gap-2 mb-3">
                                            <span class="text-[10px] font-black text-primary uppercase tracking-widest">
                                                <%= course.subject %>
                                            </span>
                                            <span class="text-slate-300">‚Ä¢</span>
                                            <span
                                                class="text-[10px] font-black text-slate-400 uppercase tracking-widest">
                                                <%= course.classLevel %>
                                            </span>
                                        </div>
                                        <h4
                                            class="text-lg font-black mb-6 leading-tight group-hover:text-primary transition-colors">
                                            <%= course.title %>
                                        </h4>

                                        <div class="space-y-3">
                                            <div class="flex justify-between items-end">
                                                <p class="text-[10px] font-black text-slate-400 uppercase">‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡ßá‡¶∏</p>
                                                <p class="text-xs font-black text-primary">‡ß¨‡ß¶% ‡¶∂‡ßá‡¶∑</p>
                                            </div>
                                            <div
                                                class="h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                                <div class="h-full bg-primary rounded-full transition-all duration-1000 group-hover:scale-x-105 origin-left"
                                                    style="width: 60%"></div>
                                            </div>
                                        </div>

                                        <div class="mt-8 flex items-center justify-between">
                                            <a href="/course-details/<%= course._id %>"
                                                class="btn-primary !py-2.5 !px-6 !text-xs !rounded-xl">‡¶ö‡¶æ‡¶≤‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</a>
                                            <span class="text-[10px] font-bold text-slate-400">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: <%=
                                                    enrollment.expiresAt ? new
                                                    Date(enrollment.expiresAt).toLocaleDateString() : '‡¶Ü‡¶ú‡ßÄ‡¶¨‡¶®' %></span>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <% } else { %>
                            <div class="p-12 text-center card-smart border-dashed border-2">
                                <div
                                    class="size-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <span class="material-symbols-outlined text-4xl text-slate-300">school</span>
                                </div>
                                <h4 class="text-xl font-black mb-2">‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡ßá ‡¶è‡¶®‡¶∞‡ßã‡¶≤ ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø</h4>
                                <p class="text-slate-500 mb-8 max-w-sm mx-auto">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∂‡ßá‡¶ñ‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü
                                    ‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>
                                <a href="/courses" class="btn-primary">‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>
                            </div>
                            <% } %>
                </section>

                <!-- Recommended / Special Offers -->
                <% if (locals.promotedCourses && promotedCourses.length> 0) { %>
                    <section class="reveal delay-400">
                        <div class="flex items-center justify-between mb-8">
                            <h3 class="h2-section !text-xl">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶Ö‡¶´‡¶æ‡¶∞ üî•</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <% promotedCourses.forEach(course=> { %>
                                <div
                                    class="card-smart !p-0 overflow-hidden flex flex-col group border-2 border-primary/5">
                                    <div class="aspect-video relative overflow-hidden">
                                        <img src="<%= course.thumbnail || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&q=80&w=800' %>"
                                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent">
                                        </div>
                                        <div class="absolute bottom-4 left-4">
                                            <span
                                                class="px-2 py-1 rounded-lg bg-primary text-white text-[10px] font-black uppercase mb-2 inline-block">
                                                <%= course.category %>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="p-6 flex-1 flex flex-col">
                                        <h4
                                            class="font-black text-lg mb-4 line-clamp-2 group-hover:text-primary transition-colors">
                                            <%= course.title %>
                                        </h4>
                                        <div
                                            class="mt-auto flex items-center justify-between pt-6 border-t border-slate-100 dark:border-slate-800">
                                            <span class="text-xl font-black text-primary">‡ß≥ <%= course.plans &&
                                                    course.plans.length> 0 ? course.plans[0].price : '0' %></span>
                                            <a href="/course-details/<%= course._id %>"
                                                class="size-10 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 flex items-center justify-center hover:scale-110 transition-transform">
                                                <span class="material-symbols-outlined text-xl">east</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                    </section>
                    <% } %>
    </main>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('main-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const observerOptions = { threshold: 0.1 };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => entry.isIntersecting && entry.target.classList.add('active'));
            }, observerOptions);
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        });
    </script>
</body>

</html>