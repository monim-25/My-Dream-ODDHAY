<!DOCTYPE html>
<html class="light" lang="bn">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>রুটিন | ODDHAY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Lexend:wght@300..900&family=Noto+Sans+Bengali:wght@300..900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#137fec" },
                    fontFamily: { "display": ["Lexend", "Noto Sans Bengali", "sans-serif"] },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Lexend', 'Noto Sans Bengali', sans-serif;
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-[#0f172a] text-slate-900 dark:text-slate-100 min-h-screen pb-20">
    <!-- Header -->
    <header
        class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-4 py-4 sticky top-0 z-50">
        <div class="max-w-2xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="/dashboard" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">
                    <span class="material-symbols-outlined">arrow_back</span>
                </a>
                <h1 class="text-lg font-black">আমার রুটিন</h1>
            </div>
            <button onclick="openAddModal()"
                class="px-4 py-2 bg-primary text-white rounded-xl text-xs font-black flex items-center gap-1">
                <span class="material-symbols-outlined text-sm">add</span> টাস্ক যোগ
            </button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto p-4 py-6 space-y-4">

        <!-- Today's Tasks -->
        <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800">
            <h3 class="text-sm font-black mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">today</span> আজকের টাস্ক
            </h3>
            <div class="space-y-3" id="todayTasks">
                <% if(tasks && tasks.filter(t=> new Date(t.date).toDateString() === new Date().toDateString()).length >
                    0) { %>
                    <% tasks.filter(t=> new Date(t.date).toDateString() === new Date().toDateString()).forEach(task => {
                        %>
                        <div
                            class="flex items-center gap-3 p-3 rounded-xl border border-slate-100 dark:border-slate-800 <%= task.isCompleted ? 'opacity-50' : '' %>">
                            <form action="/routine/toggle/<%= task._id %>" method="POST">
                                <button type="submit"
                                    class="size-8 rounded-lg <%= task.isCompleted ? 'bg-emerald-500 text-white' : 'bg-slate-100 dark:bg-slate-800' %> flex items-center justify-center">
                                    <span class="material-symbols-outlined text-sm">
                                        <%= task.isCompleted ? 'check' : '' %>
                                    </span>
                                </button>
                            </form>
                            <div class="flex-1">
                                <p class="text-sm font-black <%= task.isCompleted ? 'line-through' : '' %>">
                                    <%= task.title %>
                                </p>
                                <p class="text-[10px] text-slate-500">
                                    <%= task.time || 'সময় নির্ধারণ করা হয়নি' %>
                                </p>
                            </div>
                            <span
                                class="px-2 py-1 rounded-lg text-[9px] font-bold <%= task.type === 'exam' ? 'bg-rose-100 text-rose-600' : (task.type === 'class' ? 'bg-blue-100 text-blue-600' : 'bg-teal-100 text-teal-600') %>">
                                <%= task.type==='exam' ? 'পরীক্ষা' : (task.type==='class' ? 'ক্লাস' : 'টাস্ক' ) %>
                            </span>
                            <form action="/routine/delete/<%= task._id %>" method="POST">
                                <button type="submit" class="text-slate-400 hover:text-red-500">
                                    <span class="material-symbols-outlined text-sm">delete</span>
                                </button>
                            </form>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <div class="text-center py-8 text-slate-400">
                                    <span class="material-symbols-outlined text-4xl mb-2">event_available</span>
                                    <p class="text-sm">আজকে কোনো টাস্ক নেই</p>
                                </div>
                                <% } %>
            </div>
        </div>

        <!-- Upcoming Tasks -->
        <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800">
            <h3 class="text-sm font-black mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined text-amber-500">schedule</span> আসন্ন টাস্ক
            </h3>
            <div class="space-y-3">
                <% if(tasks && tasks.filter(t=> new Date(t.date) > new Date()).length > 0) { %>
                    <% tasks.filter(t=> new Date(t.date) > new Date()).slice(0, 5).forEach(task => { %>
                        <div
                            class="flex items-center gap-3 p-3 rounded-xl border border-slate-100 dark:border-slate-800">
                            <div class="size-8 rounded-lg bg-amber-100 text-amber-600 flex items-center justify-center">
                                <span class="material-symbols-outlined text-sm">event</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-black">
                                    <%= task.title %>
                                </p>
                                <p class="text-[10px] text-slate-500">
                                    <%= new Date(task.date).toLocaleDateString('bn-BD') %>
                                        <%= task.time ? '- ' + task.time : '' %>
                                </p>
                            </div>
                            <span class="px-2 py-1 rounded-lg text-[9px] font-bold bg-slate-100 text-slate-600">
                                <%= task.type==='exam' ? 'পরীক্ষা' : (task.type==='class' ? 'ক্লাস' : 'টাস্ক' ) %>
                            </span>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <div class="text-center py-6 text-slate-400">
                                    <p class="text-sm">কোনো আসন্ন টাস্ক নেই</p>
                                </div>
                                <% } %>
            </div>
        </div>

        <!-- All Tasks -->
        <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800">
            <h3 class="text-sm font-black mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined text-slate-500">list</span> সব টাস্ক (<%= tasks ? tasks.length :
                    0 %>)
            </h3>
            <div class="space-y-2">
                <% if(tasks && tasks.length> 0) { %>
                    <% tasks.forEach(task=> { %>
                        <div
                            class="flex items-center gap-3 p-2.5 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 <%= task.isCompleted ? 'opacity-50' : '' %>">
                            <div
                                class="size-6 rounded-lg <%= task.isCompleted ? 'bg-emerald-500' : 'bg-slate-200' %> flex items-center justify-center text-white">
                                <% if(task.isCompleted) { %><span class="material-symbols-outlined text-xs">check</span>
                                    <% } %>
                            </div>
                            <p
                                class="flex-1 text-xs font-bold <%= task.isCompleted ? 'line-through text-slate-400' : '' %>">
                                <%= task.title %>
                            </p>
                            <p class="text-[9px] text-slate-400">
                                <%= new Date(task.date).toLocaleDateString('bn-BD') %>
                            </p>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <p class="text-center text-slate-400 text-sm py-4">কোনো টাস্ক নেই</p>
                                <% } %>
            </div>
        </div>
    </main>

    <!-- Add Task Modal -->
    <div id="addModal" class="fixed inset-0 bg-black/50 z-[200] hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 w-full max-w-md">
            <h3 class="text-lg font-black mb-4">নতুন টাস্ক যোগ করুন</h3>
            <form action="/routine/add" method="POST" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">টাস্কের নাম *</label>
                    <input type="text" name="title" required
                        class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold"
                        placeholder="যেমন: গণিত পড়া">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">তারিখ</label>
                        <input type="date" name="date"
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">সময়</label>
                        <input type="time" name="time"
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">ধরন</label>
                    <select name="type"
                        class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold">
                        <option value="task">সাধারণ টাস্ক</option>
                        <option value="class">ক্লাস</option>
                        <option value="exam">পরীক্ষা</option>
                        <option value="other">অন্যান্য</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeAddModal()"
                        class="flex-1 py-3 bg-slate-100 dark:bg-slate-800 rounded-xl font-bold text-sm">বাতিল</button>
                    <button type="submit" class="flex-1 py-3 bg-primary text-white rounded-xl font-bold text-sm">যোগ
                        করুন</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mobile Bottom Nav -->
    <nav
        class="fixed bottom-0 left-0 right-0 z-[100] bg-white dark:bg-slate-900 border-t border-slate-100 dark:border-slate-800 lg:hidden pb-safe">
        <div class="flex items-center justify-around h-16">
            <a href="/dashboard" class="flex flex-col items-center gap-0.5 text-slate-400">
                <span class="material-symbols-outlined text-xl">home</span>
                <span class="text-[9px] font-black">হোম</span>
            </a>
            <a href="/messages" class="flex flex-col items-center gap-0.5 text-slate-400">
                <span class="material-symbols-outlined text-xl">mail</span>
                <span class="text-[9px] font-black">মেসেজ</span>
            </a>
            <a href="/downloads" class="flex flex-col items-center gap-0.5 text-slate-400">
                <span class="material-symbols-outlined text-xl">download</span>
                <span class="text-[9px] font-black">ডাউনলোড</span>
            </a>
            <a href="/profile" class="flex flex-col items-center gap-0.5 text-slate-400">
                <span class="material-symbols-outlined text-xl">person</span>
                <span class="text-[9px] font-black">প্রোফাইল</span>
            </a>
        </div>
    </nav>

    <script>
        function openAddModal() {
            document.getElementById('addModal').classList.remove('hidden');
            document.getElementById('addModal').classList.add('flex');
        }
        function closeAddModal() {
            document.getElementById('addModal').classList.add('hidden');
            document.getElementById('addModal').classList.remove('flex');
        }
        // Close on overlay click
        document.getElementById('addModal').addEventListener('click', function (e) {
            if (e.target === this) closeAddModal();
        });
    </script>
</body>

</html>