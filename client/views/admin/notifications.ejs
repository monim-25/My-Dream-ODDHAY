<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßÅ‡¶∂ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü - ODDHAY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        * {
            font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
        }

        .shadow-icon {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 dark:bg-slate-900">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-72 bg-white dark:bg-[#0f172a] border-r border-slate-200 dark:border-slate-800 overflow-y-auto">
            <%- include('sidebar_content', { active: 'notifications' }) %>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <!-- Top Bar -->
            <header
                class="bg-white dark:bg-[#0f172a] border-b border-slate-200 dark:border-slate-800 sticky top-0 z-10">
                <div class="flex items-center justify-between px-8 py-4">
                    <div>
                        <h1 class="text-2xl font-black text-slate-900 dark:text-white">üîî ‡¶™‡ßÅ‡¶∂ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</h1>
                        <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú
                            ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div
                            class="px-4 py-2 bg-green-50 dark:bg-green-500/10 text-green-600 dark:text-green-400 rounded-xl text-sm font-bold">
                            <span class="material-symbols-outlined text-sm align-middle">check_circle</span>
                            ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º
                        </div>
                    </div>
                </div>
            </header>

            <div class="p-8 space-y-6">
                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div
                        class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-3">
                            <span class="material-symbols-outlined text-blue-500 text-3xl">send</span>
                            <span class="text-xs font-bold text-slate-400 dark:text-slate-500">‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã</span>
                        </div>
                        <div class="text-3xl font-black text-slate-900 dark:text-white" id="stat-total">0</div>
                    </div>

                    <div
                        class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-3">
                            <span class="material-symbols-outlined text-green-500 text-3xl">check_circle</span>
                            <span class="text-xs font-bold text-slate-400 dark:text-slate-500">‡¶∏‡¶´‡¶≤</span>
                        </div>
                        <div class="text-3xl font-black text-slate-900 dark:text-white" id="stat-sent">0</div>
                    </div>

                    <div
                        class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-3">
                            <span class="material-symbols-outlined text-purple-500 text-3xl">touch_app</span>
                            <span class="text-xs font-bold text-slate-400 dark:text-slate-500">‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶∞‡ßá‡¶ü</span>
                        </div>
                        <div class="text-3xl font-black text-slate-900 dark:text-white" id="stat-click-rate">0%</div>
                    </div>

                    <div
                        class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-3">
                            <span class="material-symbols-outlined text-indigo-500 text-3xl">devices</span>
                            <span class="text-xs font-bold text-slate-400 dark:text-slate-500">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏</span>
                        </div>
                        <div class="text-3xl font-black text-slate-900 dark:text-white" id="stat-devices">0</div>
                    </div>
                </div>

                <!-- Send Notification Form -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 border border-slate-200 dark:border-slate-700">
                    <h2 class="text-xl font-black text-slate-900 dark:text-white mb-6">üì§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®</h2>

                    <div class="space-y-6">
                        <!-- Target Selection -->
                        <div>
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3">‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï
                                ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <button onclick="selectTarget('user')"
                                    class="target-btn px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-700 hover:border-primary hover:bg-primary/5 transition-all font-bold text-sm">
                                    <span class="material-symbols-outlined text-lg block mb-1">person</span>
                                    ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞
                                </button>
                                <button onclick="selectTarget('role')"
                                    class="target-btn px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-700 hover:border-primary hover:bg-primary/5 transition-all font-bold text-sm">
                                    <span class="material-symbols-outlined text-lg block mb-1">groups</span>
                                    ‡¶∞‡ßã‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ
                                </button>
                                <button onclick="selectTarget('class')"
                                    class="target-btn px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-700 hover:border-primary hover:bg-primary/5 transition-all font-bold text-sm">
                                    <span class="material-symbols-outlined text-lg block mb-1">school</span>
                                    ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ
                                </button>
                                <% if (user.role==='superadmin' ) { %>
                                    <button onclick="selectTarget('all')"
                                        class="target-btn px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-700 hover:border-primary hover:bg-primary/5 transition-all font-bold text-sm">
                                        <span class="material-symbols-outlined text-lg block mb-1">campaign</span>
                                        ‡¶∏‡¶¨‡¶æ‡¶á‡¶ï‡ßá
                                    </button>
                                    <% } %>
                            </div>
                        </div>

                        <!-- Dynamic Target Input -->
                        <div id="target-input" class="hidden">
                            <!-- Will be populated dynamically -->
                        </div>

                        <!-- Notification Content -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ
                                    (Title)</label>
                                <input type="text" id="notif-title" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶ü‡¶æ‡¶á‡¶™</label>
                                <select id="notif-type"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="announcement">üì¢ ‡¶ò‡ßã‡¶∑‡¶£‡¶æ</option>
                                    <option value="course">üìö ‡¶ï‡ßã‡¶∞‡ßç‡¶∏</option>
                                    <option value="exam">üìù ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</option>
                                    <option value="reminder">‚è∞ ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞</option>
                                    <option value="achievement">üèÜ ‡¶Ö‡¶∞‡ßç‡¶ú‡¶®</option>
                                    <option value="system">‚öôÔ∏è ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</option>
                                    <option value="custom">‚ú® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ
                                (Message)</label>
                            <textarea id="notif-body" rows="3" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶≤‡¶ø‡¶Ç‡¶ï
                                    (URL) - ‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï</label>
                                <input type="text" id="notif-url" placeholder="/dashboard" value="/dashboard"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º‡ßã‡¶∞‡¶ø‡¶ü‡¶ø</label>
                                <select id="notif-priority"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="low">üîµ Low</option>
                                    <option value="normal" selected>üü¢ Normal</option>
                                    <option value="high">üü° High</option>
                                    <option value="urgent">üî¥ Urgent</option>
                                </select>
                            </div>
                        </div>

                        <!-- Send Button -->
                        <div class="flex gap-3">
                            <button onclick="sendNotification()"
                                class="flex-1 px-6 py-4 bg-primary hover:bg-primary/90 text-white rounded-xl font-black text-lg transition-all shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30">
                                <span class="material-symbols-outlined align-middle mr-2">send</span>
                                ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                            </button>
                            <button onclick="testNotification()"
                                class="px-6 py-4 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-xl font-bold transition-all">
                                <span class="material-symbols-outlined align-middle">science</span>
                                ‡¶ü‡ßá‡¶∏‡ßç‡¶ü
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Notifications Log -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 border border-slate-200 dark:border-slate-700">
                    <h2 class="text-xl font-black text-slate-900 dark:text-white mb-6">üìú ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡¶ó</h2>
                    <div id="notification-logs" class="space-y-3">
                        <!-- Will be populated dynamically -->
                        <div class="text-center py-8 text-slate-400">
                            <span class="material-symbols-outlined text-4xl mb-2 block">inbox</span>
                            ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentTarget = null;
        let currentTargetValue = null;

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/push/stats');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('stat-total').textContent = data.stats.total || 0;
                    document.getElementById('stat-sent').textContent = data.stats.sent || 0;
                    document.getElementById('stat-click-rate').textContent = (data.stats.clickRate || 0) + '%';
                    document.getElementById('stat-devices').textContent = data.stats.activeSubscriptions || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Select target
        function selectTarget(target) {
            currentTarget = target;

            // Update button styles
            document.querySelectorAll('.target-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
            });
            event.target.closest('.target-btn').classList.add('border-primary', 'bg-primary/10', 'text-primary');

            // Show appropriate input
            const targetInput = document.getElementById('target-input');
            targetInput.classList.remove('hidden');

            if (target === 'user') {
                targetInput.innerHTML = `
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
                    <input type="text" id="target-value" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                `;
            } else if (target === 'role') {
                targetInput.innerHTML = `
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶∞‡ßã‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <select id="target-value" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="student">üë®‚Äçüéì Student</option>
                        <option value="parent">üë®‚Äçüë©‚Äçüëß Parent</option>
                        <option value="admin">üë®‚Äçüíº Admin</option>
                    </select>
                `;
            } else if (target === 'class') {
                targetInput.innerHTML = `
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <select id="target-value" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="Class 6">Class 6</option>
                        <option value="Class 7">Class 7</option>
                        <option value="Class 8">Class 8</option>
                        <option value="Class 9">Class 9</option>
                        <option value="Class 10">Class 10</option>
                        <option value="HSC 1st Year">HSC 1st Year</option>
                        <option value="HSC 2nd Year">HSC 2nd Year</option>
                    </select>
                `;
            } else if (target === 'all') {
                targetInput.innerHTML = `
                    <div class="px-4 py-3 bg-yellow-50 dark:bg-yellow-500/10 border border-yellow-200 dark:border-yellow-500/20 rounded-xl">
                        <p class="text-sm font-bold text-yellow-800 dark:text-yellow-400">‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶è‡¶á ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá!</p>
                    </div>
                `;
            }
        }

        // Send notification
        async function sendNotification() {
            if (!currentTarget) {
                alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }

            const title = document.getElementById('notif-title').value.trim();
            const body = document.getElementById('notif-body').value.trim();
            const url = document.getElementById('notif-url').value.trim();
            const type = document.getElementById('notif-type').value;
            const priority = document.getElementById('notif-priority').value;

            if (!title || !body) {
                alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                return;
            }

            const targetValueEl = document.getElementById('target-value');
            const targetValue = targetValueEl ? targetValueEl.value : null;

            let endpoint = '';
            let payload = { title, body, url, type, priority };

            if (currentTarget === 'user') {
                if (!targetValue) {
                    alert('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                    return;
                }
                endpoint = '/api/push/send-to-user';
                payload.userId = targetValue;
            } else if (currentTarget === 'role') {
                endpoint = '/api/push/send-to-role';
                payload.role = targetValue;
            } else if (currentTarget === 'class') {
                endpoint = '/api/push/send-to-class';
                payload.classLevel = targetValue;
            } else if (currentTarget === 'all') {
                if (!confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶è‡¶á ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                    return;
                }
                endpoint = '/api/push/send-to-all';
            }

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${data.result.sent || 0} ‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                    // Clear form
                    document.getElementById('notif-title').value = '';
                    document.getElementById('notif-body').value = '';
                    loadStats();
                    loadLogs();
                } else {
                    alert('‚ùå ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá');
            }
        }

        // Test notification
        async function testNotification() {
            try {
                const response = await fetch('/api/push/test', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                } else {
                    alert('‚ùå ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá');
            }
        }

        // Load notification logs
        async function loadLogs() {
            try {
                const response = await fetch('/api/push/logs?limit=10');
                const data = await response.json();

                const logsContainer = document.getElementById('notification-logs');

                if (data.success && data.logs.length > 0) {
                    logsContainer.innerHTML = data.logs.map(log => `
                        <div class="flex items-start gap-4 p-4 rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all">
                            <div class="flex-shrink-0 w-10 h-10 rounded-xl ${log.status === 'sent' ? 'bg-green-100 dark:bg-green-500/20 text-green-600' :
                            log.status === 'failed' ? 'bg-red-100 dark:bg-red-500/20 text-red-600' :
                                'bg-slate-100 dark:bg-slate-700 text-slate-600'
                        } flex items-center justify-center">
                                <span class="material-symbols-outlined text-lg">
                                    ${log.status === 'sent' ? 'check_circle' : log.status === 'failed' ? 'error' : 'schedule'}
                                </span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between gap-2 mb-1">
                                    <h3 class="font-bold text-slate-900 dark:text-white truncate">${log.title}</h3>
                                    <span class="text-xs text-slate-400 whitespace-nowrap">${new Date(log.createdAt).toLocaleString('bn-BD')}</span>
                                </div>
                                <p class="text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2">${log.body}</p>
                                <div class="flex items-center gap-2 text-xs">
                                    <span class="px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded-md font-bold">${log.type}</span>
                                    <span class="text-slate-400">‚Üí ${log.user?.name || 'Unknown'}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    logsContainer.innerHTML = `
                        <div class="text-center py-8 text-slate-400">
                            <span class="material-symbols-outlined text-4xl mb-2 block">inbox</span>
                            ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡¶ó ‡¶®‡ßá‡¶á
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading logs:', error);
            }
        }

        // Initialize
        loadStats();
        loadLogs();
        setInterval(loadStats, 30000); // Refresh stats every 30 seconds
    </script>
</body>

</html>