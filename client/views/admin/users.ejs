<!DOCTYPE html>
<html class="light" lang="bn">

<head>
    <title>User Management | ODDHAY Admin</title>
    <%- include('../partials/head') %>
        <style>
            .admin-sidebar {
                width: 280px;
                height: 100vh;
                position: fixed;
                left: 0;
                top: 0;
                background: #fff;
                border-right: 1px solid #eee;
                z-index: 100;
            }

            .dark .admin-sidebar {
                background: #101922;
                border-right: 1px solid #222;
            }

            .admin-main {
                margin-left: 280px;
                padding: 40px;
            }

            @media (max-width: 1024px) {
                .admin-sidebar {
                    display: none;
                }

                .admin-main {
                    margin-left: 0;
                }
            }
        </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100">
    <aside class="admin-sidebar p-8 overflow-y-auto">
        <%- include('sidebar_content', { active: 'users' }) %>
    </aside>

    <main class="admin-main">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
            <div>
                <h1 class="text-3xl font-black mb-2 uppercase tracking-tighter">ইউজার <span
                        class="text-primary">ম্যানেজমেন্ট</span></h1>
                <p class="text-slate-500 font-bold text-xs">প্ল্যাটফর্মের সকল ব্যবহারকারীর রোল এবং তথ্য নিয়ন্ত্রণ করুন।
                </p>
            </div>

            <div class="relative w-full md:w-96">
                <span
                    class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">search</span>
                <input type="text" id="userSearch" placeholder="নাম, ইমেইল বা ফোন দিয়ে খুঁজুন..."
                    class="w-full pl-12 pr-6 py-4 rounded-2xl bg-white dark:bg-slate-900 border-none shadow-lg focus:ring-2 focus:ring-primary transition-all font-bold text-sm">
            </div>
        </div>

        <div
            class="bg-white dark:bg-slate-900 rounded-[2.5rem] shadow-xl border border-slate-100 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-50 dark:bg-slate-800/50">
                            <th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400">নাম ও ইমেইল</th>
                            <th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400">বর্তমান রোল</th>
                            <th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400">রোল পরিবর্তন
                            </th>
                            <th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400">যোগদানের তারিখ
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
                        <% users.forEach(u=> { %>
                            <tr class="hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-colors">
                                <td class="p-6">
                                    <p class="font-black text-sm">
                                        <%= u.name %>
                                    </p>
                                    <p class="text-xs text-slate-400 font-bold">
                                        <%= u.email %>
                                    </p>
                                </td>
                                <td class="p-6">
                                    <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest 
                                        <%= u.role === 'superadmin' ? 'bg-purple-100 text-purple-600' : 
                                            u.role === 'admin' ? 'bg-red-100 text-red-600' : 
                                            u.role === 'teacher' ? 'bg-amber-100 text-amber-600' : 
                                            u.role === 'parent' ? 'bg-emerald-100 text-emerald-600' : 
                                            'bg-slate-100 text-slate-600' %>">
                                        <%= u.role %>
                                    </span>
                                </td>
                                <td class="p-6">
                                    <form action="/admin/update-role/<%= u._id %>" method="POST" class="flex gap-2">
                                        <select name="role"
                                            class="bg-slate-50 dark:bg-slate-800 border-none rounded-lg text-xs font-bold focus:ring-1 focus:ring-primary h-9">
                                            <option value="student" <%=u.role==='student' ? 'selected' : '' %>>Student
                                            </option>
                                            <option value="teacher" <%=u.role==='teacher' ? 'selected' : '' %>>Teacher
                                            </option>
                                            <option value="admin" <%=u.role==='admin' ? 'selected' : '' %>>Admin
                                            </option>
                                            <option value="parent" <%=u.role==='parent' ? 'selected' : '' %>>Parent
                                            </option>
                                        </select>
                                        <button type="submit"
                                            class="h-9 px-3 bg-primary text-white rounded-lg text-xs font-bold hover:scale-105 active:scale-95 transition-all">আপডেট</button>
                                    </form>
                                </td>
                                <td class="p-6 text-xs font-bold text-slate-400">
                                    <%= u.createdAt.toLocaleDateString() %>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    <script>
        document.getElementById('userSearch').addEventListener('keyup', function () {
            const query = this.value.toLowerCase();
            const rows = document.querySelectorAll('tbody tr');

            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                if (text.includes(query)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>
</body>

</html>