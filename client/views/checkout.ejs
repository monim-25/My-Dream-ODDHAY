<!DOCTYPE html>
<html class="light" lang="bn">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>পেমেন্ট চেকআউট | ODDHAY</title>
    <%- include('partials/head') %>
        <style>
            .method-btn {
                transition: all 0.2s ease;
            }

            .method-btn.active-bkash {
                border-color: #e91e8c;
                background: #fdf2f8;
                color: #be185d;
                box-shadow: 0 8px 24px rgba(233, 30, 140, 0.15);
            }

            .method-btn.active-nagad {
                border-color: #f97316;
                background: #fff7ed;
                color: #c2410c;
                box-shadow: 0 8px 24px rgba(249, 115, 22, 0.15);
            }

            .dark .method-btn.active-bkash {
                background: rgba(233, 30, 140, 0.1);
            }

            .dark .method-btn.active-nagad {
                background: rgba(249, 115, 22, 0.1);
            }

            .step-badge {
                width: 28px;
                height: 28px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                font-weight: 900;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .slide-in {
                animation: slideIn 0.25s ease;
            }

            .copy-btn:active {
                transform: scale(0.95);
            }
        </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen">
    <%- include('partials/nav') %>

        <div class="pt-24 pb-16 px-4 max-w-5xl mx-auto">

            <!-- Page Header -->
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-black mb-2">পেমেন্ট চেকআউট</h1>
                <p class="text-slate-400 text-sm font-bold">নিচের ধাপগুলো অনুসরণ করে পেমেন্ট সম্পন্ন করুন</p>
            </div>

            <!-- Alert messages -->
            <% if (locals.error) { %>
                <div
                    class="mb-6 p-4 bg-red-50 dark:bg-red-500/10 border border-red-200 dark:border-red-500/20 rounded-2xl flex items-center gap-3">
                    <span class="material-symbols-outlined text-red-500">error</span>
                    <p class="text-sm font-bold text-red-600">
                        <%= error %>
                    </p>
                </div>
                <% } %>

                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

                        <!-- LEFT: Order Summary -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Course Card -->
                            <div class="card-smart">
                                <h2 class="text-base font-black mb-5 flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary text-xl">shopping_basket</span>
                                    অর্ডার সামারি
                                </h2>
                                <div class="relative aspect-video rounded-2xl overflow-hidden mb-5">
                                    <img src="<%= course.thumbnail || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&q=80&w=600' %>"
                                        class="w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                                    <div class="absolute bottom-3 left-3">
                                        <span
                                            class="text-[10px] font-black bg-primary text-white px-2.5 py-1 rounded-full uppercase tracking-tighter">
                                            <%= course.category %>
                                        </span>
                                        <h3 class="font-black text-white text-sm leading-tight mt-1.5">
                                            <%= course.title %>
                                        </h3>
                                    </div>
                                </div>

                                <!-- Price breakdown -->
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="font-bold text-slate-400">কোর্স ফি</span>
                                        <span class="font-black">৳<%= course.plans && course.plans[0] ?
                                                course.plans[0].price : 0 %></span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="font-bold text-slate-400">ভ্যাট ও ট্যাক্স</span>
                                        <span class="font-black text-emerald-500">৳০</span>
                                    </div>
                                    <div
                                        class="pt-4 border-t border-slate-100 dark:border-slate-800 flex justify-between items-center">
                                        <span class="font-black">সর্বমোট</span>
                                        <span class="text-2xl font-black text-primary">৳<%= course.plans &&
                                                course.plans[0] ? course.plans[0].price : 0 %></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Security badge -->
                            <div class="card-smart !p-5">
                                <div class="flex items-start gap-3">
                                    <span class="material-symbols-outlined text-emerald-500 mt-0.5">verified_user</span>
                                    <div>
                                        <p class="text-xs font-black text-emerald-600 uppercase tracking-wider mb-1">
                                            সিকিউর পেমেন্ট</p>
                                        <p class="text-xs font-bold text-slate-400 leading-relaxed">পেমেন্ট ভেরিফাই
                                            হওয়ার পর অটোমেটিক কোর্সটি আনলক হবে। সাধারণত ১-২৪ ঘণ্টার মধ্যে।</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Steps guide -->
                            <div class="card-smart !p-5 space-y-4">
                                <p class="text-xs font-black uppercase tracking-wider text-slate-400">পেমেন্ট প্রক্রিয়া
                                </p>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3">
                                        <div class="step-badge bg-primary/10 text-primary flex-shrink-0">১</div>
                                        <p class="text-xs font-bold text-slate-500">নিচের নম্বরে পেমেন্ট করুন</p>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="step-badge bg-primary/10 text-primary flex-shrink-0">২</div>
                                        <p class="text-xs font-bold text-slate-500">Transaction ID কপি করুন</p>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="step-badge bg-primary/10 text-primary flex-shrink-0">৩</div>
                                        <p class="text-xs font-bold text-slate-500">নিচের ফর্মে জমা দিন</p>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="step-badge bg-emerald-100 text-emerald-600 flex-shrink-0">✓</div>
                                        <p class="text-xs font-bold text-slate-500">অ্যাডমিন ভেরিফাই করবেন</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT: Payment Form -->
                        <div class="lg:col-span-3">
                            <div class="card-smart !p-0 overflow-hidden">
                                <!-- Header -->
                                <div class="p-7 border-b border-slate-100 dark:border-slate-800">
                                    <h2 class="text-lg font-black flex items-center gap-2">
                                        <span
                                            class="material-symbols-outlined text-emerald-500">account_balance_wallet</span>
                                        পেমেন্ট মেথড বেছে নিন
                                    </h2>
                                </div>

                                <div class="p-7 space-y-7">
                                    <!-- Method Selector -->
                                    <div class="grid grid-cols-2 gap-4">
                                        <button onclick="selectMethod('bkash')" id="btn-bkash"
                                            class="method-btn active-bkash h-20 rounded-2xl border-2 flex flex-col items-center justify-center gap-1">
                                            <span class="text-xl font-black tracking-tight">bKash</span>
                                            <span class="text-[10px] font-bold opacity-70">মার্চেন্ট পেমেন্ট</span>
                                        </button>
                                        <button onclick="selectMethod('nagad')" id="btn-nagad"
                                            class="method-btn h-20 rounded-2xl border-2 border-slate-200 dark:border-slate-700 text-slate-400 flex flex-col items-center justify-center gap-1 hover:border-orange-300 transition-all">
                                            <span class="text-xl font-black tracking-tight text-orange-500">Nagad</span>
                                            <span class="text-[10px] font-bold opacity-70">সেন্ড মানি</span>
                                        </button>
                                    </div>

                                    <!-- bKash Form -->
                                    <div id="form-bkash" class="slide-in space-y-6">
                                        <!-- Number display -->
                                        <div
                                            class="p-6 bg-pink-50 dark:bg-pink-500/10 rounded-2xl border border-pink-200 dark:border-pink-500/20 text-center">
                                            <p class="text-xs font-black text-slate-500 mb-3 uppercase tracking-wider">
                                                বিকাশ মার্চেন্ট নম্বর</p>
                                            <div class="flex items-center justify-center gap-3">
                                                <span id="bkash-number"
                                                    class="text-3xl font-black text-pink-600 tracking-widest font-mono">
                                                    <%= process.env.BKASH_NUMBER || '01XXXXXXXXX' %>
                                                </span>
                                                <button onclick="copyNumber('bkash-number', this)"
                                                    class="copy-btn p-2 bg-pink-100 dark:bg-pink-500/20 rounded-xl hover:bg-pink-200 transition-all">
                                                    <span
                                                        class="material-symbols-outlined text-pink-600 text-lg">content_copy</span>
                                                </button>
                                            </div>
                                            <p class="text-xs font-bold text-pink-500 mt-2">Send Money → Merchant
                                                Payment</p>
                                        </div>

                                        <!-- bKash submit form -->
                                        <form action="/payment/submit" method="POST" class="space-y-5"
                                            onsubmit="return validateForm(this)">
                                            <input type="hidden" name="courseId" value="<%= course._id %>">
                                            <input type="hidden" name="planIndex" value="0">
                                            <input type="hidden" name="paymentMethod" value="bkash">
                                            <input type="hidden" name="amount"
                                                value="<%= course.plans && course.plans[0] ? course.plans[0].price : 0 %>">

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                                <div>
                                                    <label
                                                        class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">আপনার
                                                        বিকাশ নম্বর</label>
                                                    <input type="tel" name="phoneNumber" placeholder="01XXXXXXXXX"
                                                        class="w-full h-13 px-5 py-3.5 rounded-2xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-pink-500 focus:border-transparent font-black text-base outline-none transition-all"
                                                        pattern="01[3-9][0-9]{8}" maxlength="11" required>
                                                    <p class="text-xs text-slate-400 mt-1 ml-1">যে নম্বর থেকে পেমেন্ট
                                                        করেছেন</p>
                                                </div>
                                                <div>
                                                    <label
                                                        class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">ট্রানজেকশন
                                                        আইডি</label>
                                                    <input type="text" name="transactionId"
                                                        placeholder="TrxID (যেমন: ABC123XYZ)"
                                                        class="w-full h-13 px-5 py-3.5 rounded-2xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-pink-500 focus:border-transparent font-black text-base outline-none transition-all uppercase"
                                                        minlength="6" required>
                                                    <p class="text-xs text-slate-400 mt-1 ml-1">বিকাশ SMS থেকে TrxID কপি
                                                        করুন</p>
                                                </div>
                                            </div>

                                            <button type="submit"
                                                class="w-full h-14 bg-pink-500 hover:bg-pink-600 text-white font-black rounded-2xl shadow-lg shadow-pink-500/25 transition-all active:scale-[0.98] flex items-center justify-center gap-2 text-base">
                                                <span class="material-symbols-outlined">check_circle</span>
                                                পেমেন্ট নিশ্চিত করুন
                                            </button>
                                        </form>
                                    </div>

                                    <!-- Nagad Form -->
                                    <div id="form-nagad" class="hidden space-y-6">
                                        <!-- Number display -->
                                        <div
                                            class="p-6 bg-orange-50 dark:bg-orange-500/10 rounded-2xl border border-orange-200 dark:border-orange-500/20 text-center">
                                            <p class="text-xs font-black text-slate-500 mb-3 uppercase tracking-wider">
                                                নগদ নম্বর</p>
                                            <div class="flex items-center justify-center gap-3">
                                                <span id="nagad-number"
                                                    class="text-3xl font-black text-orange-600 tracking-widest font-mono">
                                                    <%= process.env.NAGAD_NUMBER || '01XXXXXXXXX' %>
                                                </span>
                                                <button onclick="copyNumber('nagad-number', this)"
                                                    class="copy-btn p-2 bg-orange-100 dark:bg-orange-500/20 rounded-xl hover:bg-orange-200 transition-all">
                                                    <span
                                                        class="material-symbols-outlined text-orange-600 text-lg">content_copy</span>
                                                </button>
                                            </div>
                                            <p class="text-xs font-bold text-orange-500 mt-2">Send Money করুন</p>
                                        </div>

                                        <!-- Nagad submit form -->
                                        <form action="/payment/submit" method="POST" class="space-y-5"
                                            onsubmit="return validateForm(this)">
                                            <input type="hidden" name="courseId" value="<%= course._id %>">
                                            <input type="hidden" name="planIndex" value="0">
                                            <input type="hidden" name="paymentMethod" value="nagad">
                                            <input type="hidden" name="amount"
                                                value="<%= course.plans && course.plans[0] ? course.plans[0].price : 0 %>">

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                                <div>
                                                    <label
                                                        class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">আপনার
                                                        নগদ নম্বর</label>
                                                    <input type="tel" name="phoneNumber" placeholder="01XXXXXXXXX"
                                                        class="w-full h-13 px-5 py-3.5 rounded-2xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-orange-500 focus:border-transparent font-black text-base outline-none transition-all"
                                                        pattern="01[3-9][0-9]{8}" maxlength="11" required>
                                                </div>
                                                <div>
                                                    <label
                                                        class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">ট্রানজেকশন
                                                        আইডি</label>
                                                    <input type="text" name="transactionId" placeholder="TrxID"
                                                        class="w-full h-13 px-5 py-3.5 rounded-2xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-orange-500 focus:border-transparent font-black text-base outline-none transition-all uppercase"
                                                        minlength="6" required>
                                                </div>
                                            </div>

                                            <button type="submit"
                                                class="w-full h-14 bg-orange-500 hover:bg-orange-600 text-white font-black rounded-2xl shadow-lg shadow-orange-500/25 transition-all active:scale-[0.98] flex items-center justify-center gap-2 text-base">
                                                <span class="material-symbols-outlined">check_circle</span>
                                                পেমেন্ট নিশ্চিত করুন
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Footer -->
                                <div
                                    class="px-7 py-5 border-t border-slate-100 dark:border-slate-800 flex items-center justify-between">
                                    <a href="/course-details/<%= course._id %>"
                                        class="text-xs font-black text-slate-400 hover:text-red-500 transition-all flex items-center gap-1">
                                        <span class="material-symbols-outlined text-sm">arrow_back</span>
                                        ফিরে যান
                                    </a>
                                    <p class="text-xs text-slate-400 font-bold">সমস্যা? <a href="/contact"
                                            class="text-primary hover:underline">সাপোর্টে যোগাযোগ করুন</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
        </div>

        <script>
            let activeMethod = 'bkash';

            function selectMethod(method) {
                activeMethod = method;
                const btnBkash = document.getElementById('btn-bkash');
                const btnNagad = document.getElementById('btn-nagad');
                const formBkash = document.getElementById('form-bkash');
                const formNagad = document.getElementById('form-nagad');

                if (method === 'bkash') {
                    formBkash.classList.remove('hidden');
                    formBkash.classList.add('slide-in');
                    formNagad.classList.add('hidden');
                    btnBkash.className = 'method-btn active-bkash h-20 rounded-2xl border-2 flex flex-col items-center justify-center gap-1';
                    btnNagad.className = 'method-btn h-20 rounded-2xl border-2 border-slate-200 dark:border-slate-700 text-slate-400 flex flex-col items-center justify-center gap-1 hover:border-orange-300 transition-all';
                } else {
                    formNagad.classList.remove('hidden');
                    formNagad.classList.add('slide-in');
                    formBkash.classList.add('hidden');
                    btnNagad.className = 'method-btn active-nagad h-20 rounded-2xl border-2 flex flex-col items-center justify-center gap-1';
                    btnBkash.className = 'method-btn h-20 rounded-2xl border-2 border-slate-200 dark:border-slate-700 text-slate-400 flex flex-col items-center justify-center gap-1 hover:border-pink-300 transition-all';
                }
            }

            function copyNumber(elementId, btn) {
                const text = document.getElementById(elementId).textContent.trim();
                navigator.clipboard.writeText(text).then(() => {
                    const icon = btn.querySelector('.material-symbols-outlined');
                    icon.textContent = 'check';
                    btn.classList.add('bg-emerald-100');
                    setTimeout(() => {
                        icon.textContent = 'content_copy';
                        btn.classList.remove('bg-emerald-100');
                    }, 2000);
                });
            }

            function validateForm(form) {
                const phone = form.querySelector('[name="phoneNumber"]').value;
                const txId = form.querySelector('[name="transactionId"]').value;

                if (!/^01[3-9][0-9]{8}$/.test(phone)) {
                    alert('সঠিক বাংলাদেশি মোবাইল নম্বর দিন (11 ডিজিট)');
                    return false;
                }
                if (txId.length < 6) {
                    alert('সঠিক ট্রানজেকশন আইডি দিন');
                    return false;
                }

                const btn = form.querySelector('button[type="submit"]');
                btn.disabled = true;
                btn.innerHTML = '<span class="material-symbols-outlined animate-spin">progress_activity</span> জমা দেওয়া হচ্ছে...';
                return true;
            }
        </script>
</body>

</html>